â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ‰ IBIKI SMS v14.2 - COMPLETE CHANGELOG
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ†• NEW FEATURES
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. CREDIT DEDUCTION âœ¨
   - Admins can now DEDUCT credits from client accounts
   - Fixed over-crediting mistakes easily
   - "Adjust Credits" button in admin dashboard
   - Choose "Add" or "Deduct" operation
   - Visual feedback with green (add) / red (deduct) colors
   - Prevents negative balances automatically
   - Transaction logging for all adjustments

2. MESSAGE STATUS ENDPOINT ğŸ“Š
   - New JWT-authenticated status check: /api/dashboard/sms/status/{messageId}
   - Works from both admin and client dashboards
   - Fetches latest status from ExtremeSMS
   - Updates local database automatically
   - Falls back to cached status if ExtremeSMS unavailable

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ› CRITICAL FIXES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. DATA PERSISTENCE FIX ğŸ”´â†’ğŸŸ¢
   PROBLEM: Users not being saved, data lost on restart
   ROOT CAUSE: Production server using in-memory storage
   FIX:
   - Server now REQUIRES DATABASE_URL in production
   - Deployment script creates .env with correct credentials
   - PM2 ecosystem config ensures .env is loaded
   - Database connection verified before startup
   - Clear logging shows which storage is being used

2. ADMIN DASHBOARD FIX
   PROBLEM: Clients not showing in admin dashboard
   ROOT CAUSE: Database schema out of sync
   FIX:
   - Database schema synchronized via npm run db:push
   - Missing "sender_phone_number" column added
   - Admin dashboard now loads all clients

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ’¡ HOW TO USE CREDIT ADJUSTMENT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

From Admin Dashboard:

1. Go to Admin Dashboard â†’ Clients tab
2. Find the client you want to adjust
3. Click "Adjust Credits" button
4. Choose operation:
   â€¢ Add Credits (green) - Increase balance
   â€¢ Deduct Credits (red) - Decrease balance
5. Enter amount (e.g., 10.00)
6. See preview of new balance
7. Click "Add Credits" or "Deduct Credits"

Examples:
- Over-credited $100 by mistake? â†’ Deduct $100
- Need to give $50 bonus? â†’ Add $50
- Client wants refund? â†’ Deduct amount

Safeguards:
âœ… Cannot deduct more than current balance
âœ… Shows warning if amount > balance
âœ… All transactions logged for audit trail
âœ… Shows before/after balance

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“‹ API ENDPOINTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

NEW:
POST /api/admin/adjust-credits
  - Adjust (add or deduct) client credits
  - Auth: JWT (admin only)
  - Body: { userId, amount, operation: "add"|"deduct" }

GET /api/dashboard/sms/status/:messageId
  - Check message delivery status
  - Auth: JWT (admin or client)
  - Returns: { success, messageId, status, statusDescription }

EXISTING (unchanged):
POST /api/admin/add-credits
  - Legacy add-only endpoint (still works)
  
GET /api/v2/sms/status/:messageId
  - API key-based status check (for external clients)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ¯ TRANSACTION LOGGING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

All credit adjustments are logged in credit_transactions table:

Type: admin_credit_add
Description: "Admin added $X credits"

Type: admin_credit_deduct
Description: "Admin deducted $X credits"

Each transaction includes:
- userId
- amount
- type (add or deduct)
- description
- balanceBefore
- balanceAfter
- timestamp

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âœ… WHAT WORKS NOW
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

DATABASE & PERSISTENCE:
âœ… Users register â†’ saved to PostgreSQL
âœ… Login works and persists across restarts
âœ… Server restart â†’ NO DATA LOSS
âœ… All data permanent (users, credits, messages, API keys)

ADMIN DASHBOARD:
âœ… See all clients
âœ… Add credits to clients
âœ… Deduct credits from clients (NEW!)
âœ… Allocate phone numbers
âœ… View message logs
âœ… Check message statuses
âœ… Monitor system activity

CLIENT DASHBOARD:
âœ… See credit balance
âœ… Send SMS messages
âœ… Check message delivery status
âœ… View message history
âœ… See per-SMS rate

API:
âœ… Send SMS programmatically
âœ… Check delivery status
âœ… Check balance
âœ… Full ExtremeSMS passthrough

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“Š DEPLOYMENT IMPROVEMENTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

The deployment script now:
âœ… Creates .env file with DATABASE_URL automatically
âœ… Tests database connection before starting
âœ… Verifies .env file exists and is readable
âœ… Shows clear errors if something is wrong
âœ… Ensures PM2 loads environment variables correctly
âœ… Displays startup logs showing storage backend

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ”§ TECHNICAL DETAILS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Frontend Changes:
- AddCreditsToClientDialog.tsx â†’ Renamed to "Adjust Credits"
- Added radio buttons for Add/Deduct selection
- Added color-coded UI (green/red)
- Added insufficient balance warning
- Updated button variants (destructive for deduct)

Backend Changes:
- server/index.ts â†’ DATABASE_URL requirement check
- server/storage.ts â†’ Storage backend logging
- server/routes.ts â†’ New /api/admin/adjust-credits endpoint
- server/routes.ts â†’ New /api/dashboard/sms/status/:messageId endpoint

Database Changes:
- message_logs.sender_phone_number (added)
- Proper credit transaction types (admin_credit_deduct)

Deployment Changes:
- ecosystem.config.js â†’ PM2 config with .env loader
- deploy-v14.2.sh â†’ Automated deployment with verification
- .env creation and validation

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

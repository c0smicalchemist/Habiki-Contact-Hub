 3. Create proper .env file
echo "âš™ï¸ Creating .env file..."
cat > /root/ibiki-sms/.env << 'EOF'
# Database Configuration
DATABASE_URL=postgresql://ibiki_user:Cosmic4382@localhost:5432/ibiki_sms

# Server Configuration
NODE_ENV=production
PORT=5000
HOST=0.0.0.0

# Session Secret
SESSION_SECRET=ibiki-sms-production-secret-2024-change-in-production

# Logging
LOG_LEVEL=info
EOF

# 4. Update database schema
echo "ğŸ—„ï¸ Updating database schema..."
npm run db:push

# 5. Restart application
echo "ğŸš€ Restarting application..."
PM2_HOME=/home/ibiki/.pm2 pm2 delete ibiki-sms 2>/dev/null || true
PM2_HOME=/home/ibiki/.pm2 pm2 start ecosystem.config.cjs
PM2_HOME=/home/ibiki/.pm2 pm2 save

# 6. Verify deployment
echo "âœ… Verifying deployment..."
sleep 3
PM2_HOME=/home/ibiki/.pm2 pm2 status
PM2_HOME=/home/ibiki/.pm2 pm2 logs ibiki-sms --lines 10
ğŸ“¦ Installing dependencies...
npm warn deprecated @esbuild-kit/esm-loader@2.6.5: Merged into tsx: https://tsx.is
npm warn deprecated @esbuild-kit/core-utils@3.3.2: Merged into tsx: https://tsx.is

added 519 packages, and audited 520 packages in 29s

67 packages are looking for funding
  run `npm fund` for details

9 vulnerabilities (3 low, 5 moderate, 1 high)

To address issues that do not require attention, run:
  npm audit fix

To address all issues (including breaking changes), run:
  npm audit fix --force

Run `npm audit` for details.
ğŸ”¨ Building application...

> rest-express@1.0.0 build
> vite build && esbuild server/index.ts --platform=node --packages=external --bundle --format=esm --outdir=dist

vite v5.4.20 building for production...
âœ“ 1623 modules transformed.
x Build failed in 7.84s
error during build:
[vite:asset] Could not load /root/ibiki-sms-v13.2-deploy/attached_assets/Yubin_Dash_NOBG_1763476645991.png (imported by client/src/pages/Landing.tsx): ENOENT: no such file or directory, open '/root/ibiki-sms-v13.2-deploy/attached_assets/Yubin_Dash_NOBG_1763476645991.png'
    at async open (node:internal/fs/promises:639:25)
    at async Object.readFile (node:internal/fs/promises:1246:14)
    at async fileToBuiltUrl (file:///root/ibiki-sms-v13.2-deploy/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:20428:19)
    at async Object.load (file:///root/ibiki-sms-v13.2-deploy/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:20328:17)
    at async PluginDriver.hookFirstAndGetPlugin (file:///root/ibiki-sms-v13.2-deploy/node_modules/rollup/dist/es/shared/node-entry.js:20689:28)
    at async file:///root/ibiki-sms-v13.2-deploy/node_modules/rollup/dist/es/shared/node-entry.js:19809:33
    at async Queue.work (file:///root/ibiki-sms-v13.2-deploy/node_modules/rollup/dist/es/shared/node-entry.js:20899:32)
âš™ï¸ Creating .env file...
ğŸ—„ï¸ Updating database schema...

> rest-express@1.0.0 db:push
> drizzle-kit push

No config path provided, using default 'drizzle.config.ts'
Reading config file '/root/ibiki-sms-v13.2-deploy/drizzle.config.ts'
DATABASE_URL, ensure the database is provisioned
ğŸš€ Restarting application...
[PM2] Applying action deleteProcessId on app [ibiki-sms](ids: [ 0 ])
[PM2] [ibiki-sms](0) âœ“
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ id â”‚ name      â”‚ namespace   â”‚ version â”‚ mode    â”‚ pid      â”‚ uptime â”‚ â†º    â”‚ status    â”‚ cpu      â”‚ mem      â”‚ user     â”‚ watching â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
[PM2][ERROR] File ecosystem.config.cjs not found
[PM2] Saving current process list...
[PM2][WARN] PM2 is not managing any process, skipping save...
[PM2][WARN] To force saving use: pm2 save --force
âœ… Verifying deployment...
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ id â”‚ name      â”‚ namespace   â”‚ version â”‚ mode    â”‚ pid      â”‚ uptime â”‚ â†º    â”‚ status    â”‚ cpu      â”‚ mem      â”‚ user     â”‚ watching â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
[TAILING] Tailing last 10 lines for [ibiki-sms] process (change the value with --lines option)
^C
root@server68521:~/ibiki-sms-v13.2-deploy#
